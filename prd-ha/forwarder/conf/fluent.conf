<system>
  log_level info # nível de logs
</system>

# Input via tail, onde o fluentd lê os arquivos de logs dos containers a partir da linha final do arquivo
<source>
  @type tail
  path /fluentd/containers/log/*log # path de onde o fluentd vai ler os logs
  read_from_head true # leitura de cima para baixo, do mais antigo para o mais novo, por padrão é o inverso
  follow_inodes true # como o path dos logs é genérico é necessário essa propriedade para evitar logs duplicados
  pos_file /fluentd/log/containers.log.pos # salva a ultima posição lida para continuar a partir dela
  tag containers # identificador do evento
  <parse>
    @type apache2 ## tipo do log, no caso desse ambiente a aplicação que está enviando logs é um apache2
  </parse>
</source>

# Output via forward, onde o fluentd envia os logs para um destino, nesse caso é um outro fluentd denominado aggregator responsável pelos filtros e pelo envio para o elasticsearch
<match containers>
  @type forward
  # send_timeout 60s # tempo limite de envio dos logs
  # recover_wait 10s # tempo de espera para uma falha
  # hard_timeout 60s # tempo para detectar uma falha

  <server> # servidor para qual os logs serão enviados, podem ser adicionados outros servidores e com a propriedade standby já funciona como um loadbalancer em caso de falha
    host aggregator
    port 24224
    weight 60 # prioridade do servidor
  </server>
</match>
